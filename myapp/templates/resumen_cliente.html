{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Resumen del Cliente</title>
  <link rel="stylesheet" href="{% static 'estilo.css' %}">
  <link rel="stylesheet" href="{% static 'resumen.css' %}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div class="resumen" id="resumen" style="background: white; padding: 20px;">
  <p class="h1es">Resumen del Evento</p>
  
  <!-- âœ… Datos del Cliente -->
  <h2>{{ cliente.nombre }}</h2>
  <p>{{ cliente.dni }}</p>
  <p>{{ cliente.fecha_evento|date:"j/n/Y" }} - {{ cliente.salon }}</p>
  
  <h3>ğŸ“ TelÃ©fonos de Contacto</h3>
  {% if telefono %}
    <p>
      {% if telefono.numero1 %}TelÃ©fono 1: {{ telefono.numero1 }}{% endif %}
      {% if telefono.numero2 %}<br>TelÃ©fono 2: {{ telefono.numero2 }}{% endif %}
    </p>
  {% else %}
    <p>No se registraron telÃ©fonos</p>
  {% endif %}
  
  <h3>ğŸ§‘â€ğŸ¤â€ğŸ§‘ Cantidad de Personas</h3>
  <p>
    {% if cantidad_personas %}
      {{ cantidad_personas }} personas
    {% else %}
      No se indicÃ³ la cantidad
    {% endif %}
  </p>
  
  <hr>
  
  <!-- âœ… Comida y Bebida -->
   <h3>ğŸ¥‚ RecepciÃ³n</h3>
  <ul>{% for item in recepcion_items %}<li>{{ item.item }}</li>{% empty %}<li>No hay recepciÃ³n</li>{% endfor %}</ul>
  
   <h3>ğŸ¸ Barra de Tragos</h3>
  <p>
    {% if barra_tragos %}
      {{ barra_tragos }}
    {% else %}
      No se eligiÃ³ barra de tragos
    {% endif %}
  </p>

  <h3>ğŸ½ï¸ Platos</h3>
  {% if elegir_platos %}
  <p>Plato Principal: {{ elegir_platos.plato_principal }}</p>
  <p>Plato Infantil: {{ elegir_platos.plato_infantil }}</p>
  <p>Aclaraciones: {{ elegir_platos.aclaraciones_alimentarias }}</p>
  <p>Adultos: {{ elegir_platos.num_adultos }}</p>
  <p>NiÃ±os: {{ elegir_platos.num_ninos }}</p>
{% else %}
  <p>No se eligieron platos aÃºn.</p>
{% endif %}

 
  
  <h3>ğŸ• Islas Seleccionadas</h3>
  <ul>{% for isla in islas %}<li>{{ isla.nombre }}</li>{% empty %}<li>No hay islas seleccionadas</li>{% endfor %}</ul>
  
  <h3>ğŸ½ï¸ Islas Premium</h3>
  <ul>{% for isla in islas_premium %}<li>{{ isla.nombre }}</li>{% empty %}<li>No hay islas premium</li>{% endfor %}</ul>
  
  <h3>ğŸ° Postres</h3>
  <ul>{% for postre in postres %}<li>{{ postre.nombre }}</li>{% empty %}<li>No hay postres</li>{% endfor %}</ul>
  
  <h3>ğŸ­ Mesa Dulce Premium</h3>
  <ul>{% for item in mesa_dulce %}<li>{{ item.nombre }}</li>{% empty %}<li>No hay mesa dulce premium</li>{% endfor %}</ul>
  
  
  
  <h3>ğŸŒ… Fin de Fiesta</h3>
  <p>{% if fin_de_fiesta %}{{ fin_de_fiesta.nombre }}{% else %}No se eligiÃ³ aÃºn{% endif %}</p>
  
  <hr>
  
  <!-- âœ… Extras y Entretenimiento -->
  <h3>ğŸ Extras</h3>
  <ul>{% for extra in extras %}<li>{{ extra.nombre }}</li>{% empty %}<li>No hay extras</li>{% endfor %}</ul>
  
  <h3>ğŸ¤ Shows</h3>
  <ul>{% for show in shows %}<li>{{ show.nombre }}</li>{% empty %}<li>No hay shows</li>{% endfor %}</ul>
</div>

<div style="text-align: center; margin-top: 20px;">
  <button onclick="descargarPDF()">ğŸ“„ Descargar Resumen en PDF</button>
</div>

<div style="display: flex; flex-direction: column; align-items: center; gap: 10px; margin-top: 20px;">
  <a href="{% url 'inicio' %}"><button type="button">Volver al inicio</button></a>
</div>

<script>
function descargarPDF() {
    const elemento = document.getElementById('resumen');
    let nombreCliente = "{{ cliente.nombre|escapejs }}";
    
    nombreCliente = nombreCliente
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
      .replace(/\s+/g, "_")
      .replace(/[^\w\-]/g, "");
    
    const opciones = {
      margin: 0.5,
      filename: `resumen_evento_${nombreCliente}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    
    window.scrollTo(0, 0);
    setTimeout(() => { html2pdf().set(opciones).from(elemento).save(); }, 200);
}
</script>

</body>
</html>